{% extends "hydroshare_gis_data_viewer/base.html" %}
{% load tethys_gizmos %}
{% load staticfiles %}

{% block header_buttons %}
  <div class="header-button glyphicon-button" data-toggle="tooltip" data-placement="bottom" title="Help">
    <a data-toggle="modal" data-target="#help-modal"><span class="glyphicon glyphicon-question-sign"></span></a>
  </div>
{% endblock %}

{% block app_navigation_items %}
  <div id="nav-container">
    <div id="nav-tab-button-container">
      <button id="discover-tab-button" class="nav-tab-button">Discover</button>
      <button id="workspace-tab-button" class="nav-tab-button">Workspace</button>
    </div>
    <div id="workspace-layer-section-header" class="workspace-content">
      <h5>Layers</h5>
    </div>
    <div id="workspace-table-container" class="workspace-content">
      <table id="workspace-table" class="hover">
        <thead>
          <tr>
            <th id="workspace-layer-id"></th>
            <th id="workspace-layer-code"></th>
            <th id="workspace-layer-icon"></th>
            <th id="workspace-layer-name"></th>
            <th id="workspace-layer-drag"></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div id="workspace-action-section-header" class="workspace-ontent hidden">
      <h5>Actions</h5>
    </div>
    <div id="workspace-action-buttons" class="workspace-ontent hidden">
      <button id="add-resource-modal-button" data-toggle="modal" data-target="#add-resource-modal" class="workspace-action-button">Add Resource</button>
      <button id="create-resource-modal-button" data-toggle="modal" data-target="#!create-resource-modal" class="workspace-action-button btn-disable">Create Resource</button>
      <button id="export-png-button" data-toggle="modal" class="workspace-action-button">Export PNG</button>
      <button id="export-map-modal-button" data-toggle="modal" data-target="#!export-map-modal" class="workspace-action-button btn-disable">Export Map</button>
    </div>
    <div id="discover-layer-section-header" class="discover-content">
      <div id="discover-input-container">
        <input id="discover-input" type="text" placeholder="Find Layers...">
        <div id="discover-button-container" class="hidden">
          <span id="discover-button" class="glyphicon glyphicon-filter"></span>
        </div>
      </div>
    </div>
    <div id="discover-table-container" class="discover-content">
      <table id="discover-table">
        <thead>
          <tr>
            <th id="discover-layer-id"></th>
            <th id="discover-layer-res-id"></th>
            <th id="discover-layer-icon"></th>
            <th id="discover-layer-name"></th>
            <th id="discover-layer-add"></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
{% endblock %}

{% block app_content %}
  <div id="map" class="map"></div>
  <div class="data-viewer-container">
    <div class="data-viewer-header">
      <ul class="data-viewer-tabs hidden">
        <li id="layer-options-tab" class="data-viewer-tab active" > 
          <a href=# >Layer Options</a> 
        </li>
        <li id="attr-table-tab" class="data-viewer-tab"> 
          <a href=# >Attribute Table</a> 
        </li>
        <li id="ts-plot-tab" class="data-viewer-tab ts-plot-disabled">
          <a href=# >Time Series Plot</a>
        </li>
      </ul>
      <div id="data-viewer-show" class="data-viewer-toggle hidden"  data-toggle="tooltip" data-placement="left" title="Expand">
        <a><span class="glyphicon glyphicon-chevron-up"></span></a>
      </div>
      <div id="data-viewer-hide" class="data-viewer-toggle hidden"  data-toggle="tooltip" data-placement="left" title="Collapse">
        <a><span class="glyphicon glyphicon-chevron-down"></span></a>
      </div>
    </div>
    <div class="data-viewer-content hidden">
      <div id="layer-options-tab-view" class="data-viewer-content-page">
        <div class="data-viewer-section">
          <h6><b>Actions</b></h6>
          <button id="show-layer-btn" type="button" class="action-btn btn btn-default hidden">Show Layer</button>
          <button id="hide-layer-btn" type="button" class="action-btn btn btn-default">Hide Layer</button>
          <button id="zoom-to-layer-btn" type="button" class="action-btn btn btn-default">Zoom to Layer</button>
          <button disabled id="download-data-btn" type="button" class="action-btn btn btn-default">Download Data</button>
          <button id="remove-layer-btn" type="button" class="action-btn btn btn-danger" data-toggle="modal" data-target="#remove-layer-modal">Remove Layer</button>
        </div>
        <div class="data-viewer-section">
          <h6><b>Styling</b></h6>
          <div id="styling-container" class="data-viewer-section-content">
            <div id="layer-name-container" class="symbology-input-container">
              <label>Layer Name:</label>
              <input id="layer-name-input" type="text">
            </div>
            <div id="fill-color-container" class="symbology-input-container">
              <label>Fill Color:</label>
              <input id="fill-color-selector" comp="fill" type="text" class="color-selector"/>
            </div>
            <div id="line-color-container" class="symbology-input-container">
              <label>Line Color:</label>
              <input id="line-color-selector" comp="stroke" type="text" class="color-selctor"/>
            </div>
            <div id="line-size-container" class="symbology-input-container">
              <label>Line Thickness:</label>
              <select id="line-size-input" class="symbology-input">
                <option selected="selected"value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
              </select>
            </div>
            <div id="point-size-container" class="symbology-input-container">
              <label>Point Size:</label>
              <select id="point-size-input" class="symbology-input">
                <option value="2">2</option>
                <option value="4">4</option>
                <option selected value="6">6</option>
                <option value="8">8</option>
                <option value="10">10</option>
              </select>
            </div>
            <div id="point-shape-container" class="symbology-input-container">
              <label>Point Shape:</label>
              <select id="point-shape-input" class="symbology-input">
                <option value="circle">Circle</option>
                <option value="square">Square</option>
                <option value="triangle">Triangle</option>
              </select>
            </div>
            <div id="font-attr-container" class="symbology-input-container">
              <label>Font:</label>
              <select></select>
            </div>
            <div id="font-family-container" class="symbology-input-container">
              <label>Font Family:</label>
              <select>
                <option value="ariel">Ariel</option>
                <option value="times">Times New Roman</option>
              </select>
            </div>
            <div id="font-color-container" class="symbology-input-container">
              <label>Font Color:</label>
              <input id="font-color-selector" comp="font" type="text" class="color-selctor"/>
            </div>
            <div id="font-size-container" class="symbology-input-container">
              <label>Font Size:</label>
              <option value="6">6</option>
              <option value="8">8</option>
              <option value="10">10</option>
              <option value="12">12</option>
              <option value="14">14</option>
              <option value="16">16</option>
              <option value="18">18</option>
              <option value="20">20</option>
            </div>
            <div id="color-map-container" class="symbology-input-container">
              <label>Color Map:</label>
              <select id="color-map-input" class="symbology-input">
                <option value="gray">Gray</option>
                <option value="rainbow">Rainbow</option>
                <option value="electric">Electric</option>
                <option value="bone">Bone</option>
                <option value="blackbody">Blackbody</option>
                <option value="viridis">Viridis</option>
                <option value="jet">Jet</option>  
                <option value="hot">Hot</option>
                <option value="cool">Cool</option>
                <option value="magma">Magma</option>
                <option value="plasma">Plasma</option>   
                <option value="spring">Spring</option>
                <option value="summer">Summer</option>
                <option value="autumn">Autumn</option>
                <option value="winter">Winter</option>
              </select>
            </div>
            <div id="basemap-container" class="symbology-input-container">
              <label>Basemap:</label>
              <select id="basemap-select">
                <option value="satellite">Satellite Map</option>
                <option value="street">Street Map</option>
                <option value="grey">Gray Map</option>
                <option value="dark">Dark Map</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      <div id="attr-table-tab-view" class="data-viewer-content-page hidden">
        <div id="attribute-table-container" class="hidden">
          <table id="attribute-table" class="hover">
            <thead><th>Feature</th></thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="attr-loading">Loading Attribute Table...</div>
        <div id="attr-error" class="hidden">Unable to Load Attribute Table</div>
      </div>
      <div id="ts-plot-tab-view" class="data-viewer-content-page hidden">
        <div id="plot"></div>
        <div id="plot-loading" class="hidden">
          <img class="main-loading-animation" src="/static/hydroshare_gis_data_viewer/images/main-loading-anim.gif">
        </div>
      </div>
    </div>
  </div>
  <div id="config-data" class="hidden">
    <div id=geoserver_url>{{geoserver_url}}</div>
    <div id=hydroserver_url>{{hydroserver_url}}</div>
  </div>
{% endblock %}

{# Use the after_app_content block for modals #}
{% block after_app_content %}

  <!-- Help Modal -->
  <div class="modal fade" id="help-modal" tabindex="-1" role="dialog" aria-labelledby="help-modal-label">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h5 class="modal-title" id="help-modal-label">Using the HydroShare GIS Data Viewer</h5>
        </div>
        <div class="modal-body">
          <p>This app uses OGC Web Services to help you visualize geospatial data stored on HydroShare. Public geographic feature and geographic raster data are currently supported.</p>
          <p>The leftside pane of the app contains a list of layers, including the basemap. These layers can be reordered by clicking on the double sided arrow and dragging it up or down. This pane also acts a legend with the icons representing the layer type and styling. You can click on a layer to activate it.</p>
          <p>When you click on a layer to activate it, a bottom pane appears with additional options and information. All layers have a variety of styling options that you can edit. Geographic feature layers also have an attribute table available in this pane. This attribute table may not be available for very large layers.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Remove Layer Confirmation -->
  <div class="modal fade" id="remove-layer-modal" tabindex="-1" role="dialog" aria-labelledby="remove-layer-modal-label">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h5 class="modal-title">Confirm Layer Removal</h5>
        </div>
        <div class="modal-body">
          <h8>Are you sure you want to remove this layer from the map?</h8> 
          <br><br>
          <h8>Note: This will not affect the HydroShare resource.</h8>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button id="remove-layer-confirm-btn" type="button" class="btn btn-danger" data-dismiss="modal">Remove Layer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Resource Modal -->
  <div class="modal fade" id="add-resource-modal" tabindex="-1" role="dialog" aria-labelledby="add-resource-modal-label">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h5 class="modal-title">Add HydroShare Resource</h5>
        </div>
        <div class="modal-body">
          <h8>Please enter a HydroShare resource ID to get data from. The resource should be public and contain geographic feature and/or geographic raster content.</h8> 
          <br><br>
          <form>
            Resource ID:<br>
            <input id="resource-id-input" type="text" name="resource-id" style="float:left;">
            <h8 id="add-resource-message" class="hidden" style="float:left; padding-left: 20px;">Loading...</h8>
            <br>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button id="add-resource-btn" type="button" class="btn btn-default">Add Resource</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Resource Modal -->
  <div id="create-resource-modal" class="modal fade modal-admin" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h5 class="modal-title">Create HydroShare Resource</h5>
        </div>
        <div class="modal-body">
          <h8>This dialog will help you upload local files to HydroShare so you can view them in this app. You can upload either a Shapefile, GeoTIFF, or ODM2 SQLite file. This action will set the resource as public so it can be accessed by the app.</h8><br><br>
          <div>
            <select class="local-file-select">
              <option value="shapefile">Shapefile (Geographic Feature)</option>
              <option value="geotiff">GeoTiff (Geographic Raster)</option>
              <option value="odm2">ODM2 SQLite (Time Series)</option>
            </select>
            <br><br>
            <input id="shapefile-upload" class="local-file-upload" type="file" accept=".shp,.prj,.shx,.dbf" multiple>
            <input id="geotiff-upload" class="local-file-upload hidden" type="file" accept=".tif">
            <input id="odm2-upload" class="local-file-upload hidden" type="file" accept=".db,.sqlite">
            <br>
          </div>
          <div class="form-group">
            <label for="create-res-title" class="control-label">Resource Title:</label>
            <input id="create-res-title" type="text" class="form-control" placeholder="Type the name of your resource here.">
          </div>
          <div class="form-group">
            <label for="create-res-abstract" class="control-label">Resource Abstract:</label>
            <textarea id="create-res-abstract" rows="6" cols="50" spellcheck="false" class="form-control" placeholder="Type your abstract here." style="resize:none"></textarea>
          </div>
          <div class="form-group">
            <label for="create-res-keywords" class="control-label">Resource Keywords:</label>
            <input id="create-res-keywords" type="text" class="form-control" placeholder="Type your keywords here.">
          </div>
          <div>*Note: This resource will be public.</div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button id="btn-create-timeseries-resource" type="button" class="btn btn-success">Create Resource</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Export Map Modal -->
  <div id="export-map-modal" class="modal fade modal-admin" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h5 class="modal-title">Export Map to HydroShare</h5>
        </div>
        <div class="modal-body">
          <h8>This dialog will help you create a HydroShare resource containing a reference JSON file defining the current state of your map including any layers and styling information. This resource only contains reference data, it will not include a copy of the data.</h8><br><br>
          <div class="form-group">
            <label for="export-map-title" class="control-label">Resource Title:</label>
            <input id="export-map-title" type="text" class="form-control" placeholder="Type the name of your resource here.">
          </div>
          <div class="form-group">
            <label for="export-map-abstract" class="control-label">Resource Abstract:</label>
            <textarea id="export-map-abstract" rows="6" cols="50" spellcheck="false" class="form-control" placeholder="Type your abstract here." style="resize:none"></textarea>
          </div>
          <div class="form-group">
            <label for="export-map-keywords" class="control-label">Resource Keywords:</label>
            <input id="export-map-keywords" type="text" class="form-control" placeholder="Type your keywords here.">
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="chk-public" checked="checked">
            <label class="form-check-label" for="chk-public">Make Resource Public</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button id="btn-create-timeseries-resource" type="button" class="btn btn-success">Create Resource</button>
        </div>
      </div>
    </div>
  </div>

{% endblock %}

{% block app_actions %}
{% endblock %}